<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../../glitterBundle/ControlInstance.js"></script>
    <link rel="stylesheet" type="text/css" href="../../glitterBundle/layout/css/flexslider.css"/>
    <script type="text/javascript" src="../../glitterBundle/layout/js/jquery.flexslider.js"></script>
    <link rel="stylesheet" type="text/css" href="../reactJS/ReplyContent.css"/>
    <script src="../../glitterBundle/babel.min.js"></script>
    <script src="../../glitterBundle/react.production.min.js" crossorigin></script>
    <script src="../../glitterBundle/react-dom.production.min.js" crossorigin></script>
    <script src="../../glitterBundle/create-react-class.min.js" crossorigin></script>
    <script src="../../prop-types/prop-types.js"></script>
    <script src="../../dist/react-infinite.js"></script>
    <script src="../reactJS/ShowArticle.js" type="text/babel"></script>
</head>
<style>
    html {
        width: 100%;
        height: 100%;
    }

    body {
        overflow: hidden;
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
    }
    .topBar2 {
        padding: 0;
        width: 100%;
        display: flex;
        height: 50px;
        background-color: dodgerblue;
        margin: 0;
    }

    .previewContent {
        margin-top: 0px;
        line-height: 30px;
        margin-right: 10px;
        margin-left: 10px;
        font-size: 16px;
        overflow-y: scroll;
        overflow-x: hidden;
        white-space: normal;
        padding-bottom: 10px;
        word-wrap: break-word;
        word-break: break-all;
    }

    .selectDic .head {
        width: 30px;
        height: 30px;
        border-radius: 15px;
    }

    .selectDic {
        height: 50px;
        margin: 0px;
        display: flex;
        align-items: center;

    }

    .flexText {
        color: black;
        font-size: 17px;
        margin-left: 10px;
    }

    .bottomBar {
        height: 50px;
        position: fixed;
        width: 100%;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        bottom: 0;
        display: flex;
        background-color: white;
    }

    .bottomBar .head {
        width: 30px;
        height: 30px;
        border-radius: 15px;
        transform: translateY(-50%);
        position: relative;
        top: 50%;
        margin-left: 10px;
    }

    .ite {
        width: 20px;
        height: 20px;
        transform: translateY(-50%);
        top: 50%;
        position: relative;
        fill: rgba(0, 0, 0, 0.2);
    }

    .scrollView {
        overflow-y: scroll;
    }

    .cList {
        width: 100%;
        height: 40px;
        display: flex;
    }
    .flexBar {
        display: flex;
        width: 100%;
    }
    .titleBar {
        min-height: 50px;
        width: 100%;
        height: 50px;
        background-color: dodgerblue;
        display: flex;
        align-items: center;
    }
    

    .replayBox {
        height: 50px;
        width: 100%;
        background-color: white;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        display: flex;
        align-items: center;
        position: fixed;
        bottom: 0;
        z-index: 3;
    }
    .more{
        min-width: 40px;
        cursor: pointer;
        display: flex;
        font-size: 25px;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        color: #8e8e8e;
        font-weight: 600;
        height: 100%;
        width: 40px;
    }
    .flexPencil{
        margin-left: 10px;
        padding: 0;
        display: flex;
        flex: auto;
        background-color: whitesmoke;
        height: 40px;
        font-size: 14px;
        align-items: center;
    }
    .flexPencil img{
        width: 20px;
        height: 20px;
        margin-right: 3px;
        margin-left: 3px;
    }
    .flexPencil input{
        padding: 0;
        background-color: transparent;
        flex: auto;
        width: calc(100% - 60px);
        margin-left: 5px;
        font-size: 14px;
        border: 0 none;
        height: 30px;
    }
    .loveBar{
        margin-left: 5px;
        height: 100%;
        justify-content: center;
        display: flex;
        align-items: center;
        font-size: 13px;
        min-width: 50px;
        color: gray;
    }
    .loveBar img{
        width: 20px;
        height: 20px;
        margin-right: 3px;
    }

    .toTop{
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-width: 50px;
        margin-right: 5px;
        height: 100%;
    }
    .toTop img{
        width: 15px;
        height: 15px;
    }
    .toTop span{
        font-size: 10px;
        margin-top: -3px;
        color: gray;
    }
    .spi{
        margin-bottom: 10px;
        background-color: whitesmoke;height: 1px;width: 100%;
    }
    .flexslider{
        position: relative;
    }
</style>
<body>

</body>

</html>
<script>
    lifeCycle.onCreate = function () {
        if(gBundle.circle==="5"){
            if(typeof(gBundle.titleImage)==='string'){
                gBundle.titleImage=JSON.parse(gBundle.titleImage)
                gBundle.image=gBundle.titleImage
            }
        }else{
            if(typeof(gBundle.image)==='string'){
                gBundle.image=JSON.parse(gBundle.image)
            }
        }
        $('.deleteImage').hide()
    }

    lifeCycle.onCreateView = function () {
        return `<div class="titleBar">
<img src="../img/btn_back_normal.png" style="width: 40px;height: 40px;margin-left: 10px;" onclick="glitter.goBack()">
<h3 style="color: white;flex: auto;font-size: 16px;text-align: center;">${(gBundle.pick)}</h3>
<img src="${gBundle.head}" style="width: 30px;height: 30px;margin-right: 10px;border-radius: 50%;" onclick="glitter.goBack()">
</div>
<div class="Content" id="ArticleContent" style="height: calc(100vh - 100px);"></div>
<div class="replayBox">
<div class="flexPencil">
<img src="../img/pencil.png" id="pencil">
<input id="replyText" type="text" onfocus="textOnFocus()" onblur="disableFocus()">
<img src="../img/send.png" style="display: none;cursor: pointer;" id="sendBt" onclick="snedMessage()">
</div>
<div class="loveBar" style="display: flex;flex-direction: column;align-items: center;width: 40px;justify-content: center;height: 100%;" onclick="sendLove()">
<img style="width: 20px;height: 20px;" src="${(gBundle.myLove) ? '../img/heart2.png':'../img/heart.png'}">
<h3 style="font-size: 11px;margin: 0;color: darkgrey;">${gBundle.love}</h3>
</div>
<div style="display: flex;flex-direction: column;align-items: center;width: 40px;justify-content: center;height: 100%;" onclick="addSub()">
<img id="subImg"  style="width: 20px;height: 20px;" src="${(gBundle.mySub) ? '../img/bookmark2.png':'../img/bookmark.png'}">
<h3 style="font-size: 11px;margin: 0;color: darkgrey;">收藏</h3>
</div>

</div>
`
    }
    lifeCycle.onResume=function (){
    }
    function addSub(){
        glitter.share.dataLoading(true)
        glitter.publicBeans.publicLogic.subArticle({
            add:!gBundle.mySub,
            id:gBundle.id
        },function (response){
            glitter.share.dataLoading(false)
            if(response===undefined){
                glitter.share.internetError()
            }else{
                if(response.result){
                    gBundle.mySub=!gBundle.mySub
                    $('#subImg').attr('src',(gBundle.mySub) ? '../img/bookmark2.png':'../img/bookmark.png')
                }
            }
        })
    }

    //鍵盤輸入監聽
    function textOnFocus(){
        $('#pencil').hide()
        $('#sendBt').show()
    }
    //鍵盤停止輸入監聽
    function disableFocus(){
        if($('#replyText').val()===''){
            $('#pencil').show()
            $('#sendBt').hide()
        }
    }
    //傳送留言
    function snedMessage(){
        if($('#replyText').val()===''){
            glitter.share.hint('請輸入回覆內容!!')
            return
        }
        glitter.share.dataLoading(true)
        glitter.publicBeans.publicLogic.replyMessage(gBundle.id,{
            message:($('#replyText').val())
        },function (response){
            glitter.share.dataLoading(false)
            if(response===undefined){
                glitter.share.hint('請檢查網路連線!!')
            }else{
                if(response.result){
                    reloadMessage()
                    gBundle.replyCount=(parseInt(gBundle.replyCount,10)+1)
                    $('#replyText').val('')
                }else{
                    glitter.share.hint('回覆留言失敗!!')
                }
            }
        })
    }
    //文章按讚
    function sendLove(){
        glitter.share.dataLoading(true)
        glitter.publicBeans.publicLogic.postLike({
            id:gBundle.id,
            type:'Article'
        },function (response){
            glitter.share.dataLoading(false)
            if(response===undefined){
                glitter.share.internetError()
            }else{
                if(response.result){
                    gBundle.myLove=!gBundle.myLove
                    if(gBundle.myLove){gBundle.love++}else{gBundle.love--}
                    $('.loveBar').html(`
<img style="width: 20px;height: 20px;" src="${(gBundle.myLove) ? '../img/heart2.png':'../img/heart.png'}">
<h3 style="font-size: 11px;margin: 0;color: darkgrey;">${gBundle.love}</h3>`)
                }else{
                    glitter.share.internetError()
                }
            }

        })
    }

</script>