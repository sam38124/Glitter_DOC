<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../glitterBundle/ControlInstance.js"></script>
</head>
<style>
    html{
        width: 100%;
        height: 100%;
    }
    body{
        width: 100%;
        height: 100%;
    }
    .topBar {
        width: 100%;
        height: 50px;
        background-color: dodgerblue;
        display: flex;
        align-items: center;
    }

    .flexbox {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .circleSelect.active {
        background-color: orangered;
    }

    .circleSelect {
        border-radius: 18px;
        background-color: white;
        width: 18px;
        height: 18px;
        border-width: 3px;
        border-color: lightgray;
        border-style: solid;
    }
    .circleSelect2.active {
        background-color: orangered;
    }

    .circleSelect2 {
        border-radius: 18px;
        background-color: white;
        width: 18px;
        height: 18px;
        border-width: 3px;
        border-color: lightgray;
        border-style: solid;
    }
    .circleSelect3.active {
        background-color: orangered;
    }

    .circleSelect3 {
        border-radius: 18px;
        background-color: white;
        width: 18px;
        height: 18px;
        border-width: 3px;
        border-color: lightgray;
        border-style: solid;
    }
    .inSelct{
        background-color:white;border-radius:10px; display: flex;align-items: center;justify-content: start;height: 40px;min-height: 40px;
        margin-top: 0;
        margin-right: 10px;
        min-width: 100px;
    }
    .inSelct2{
        margin-top: 0;
        margin-right: 10px;
        min-width: 100px;
        background-color:white;border-radius:10px; display: flex;align-items: center;justify-content: start;height: 40px;min-height: 40px;
    }
    .inSelct3{
        margin-top: 0;
        margin-right: 10px;
        min-width: 100px;
        background-color:white;border-radius:10px; display: flex;align-items: center;justify-content: start;height: 40px;min-height: 40px;
    }

    .content {
        width: 100%;
        display: flex;
        align-items: center;
        overflow-y: scroll;
        flex-direction: column;
    }

    .head {
        min-height: 100px;
        min-width: 100px;
        width: 100px;
        height: 100px;
        border-radius: 50px;
        background-color: whitesmoke;
        margin-top: 23px;
    }

    .smallTitle {
        width: calc(100% - 30px);
        color: black;
        font-size: 15px;
        margin-bottom: 0;
    }

    input {
        min-height: 30px;
        height: 30px;
        color: black;
        font-weight: 400;
        font-size: 15px;
        width: calc(100% - 35px);
        border-color: #aaaaaa;
        border-width: 1px;
        border-style: solid;
        padding-left: 5px;
        border-radius: 2px;
        margin-top: 10px;
    }

    .hint {
        color: #8e8e8e;
        font-size: 13px;
        font-weight: 400;
        width: calc(100% - 30px);
        margin-top: 5px;
    }

    textarea {
        width: calc(100% - 40px);
        height: 60px;
        min-height: 60px;
        margin-top: 5px;
        padding: 5px;
        font-size: 14px;
        border-color: #aaaaaa;
        border-width: 1px;
        border-style: solid;
    }
    .flexSelect{
        height: 30px;
        margin-top: 20px;
        display: flex;
        justify-content: left;
        width: calc(100% - 30px);
        margin-bottom: 10px;
    }
    .selectItem{
        display: flex;
        align-items: center;
        margin-right: 10px;
    }
    .item{
        border-width: 2px;
        border-color: gray;
        border-style: solid;
        border-radius: 50%;
        width: 20px;
        margin-left: 0;
        height: 20px;
    }
    .select{
        background-color: red;
    }
    .selectItem span{
        font-size: 11px;
        margin-left: 5px;
    }
    .checkBox{
        border-width: 2px;
        border-style: solid;
        border-color: dodgerblue;
        margin-left: 0;
        width: 20px;
        background-size: 20px 20px;
        height: 20px;
    }
    .check{
        background-image: url("../img/checkbox_check.png");
    }
    select{
        background-image:url("../img/trangle.png");
        background-position: right 10px center;
        background-repeat: no-repeat;
        background-color: white;
        appearance:none;
        -moz-appearance:none;
        -webkit-appearance:none;
        padding-left: 10px;
        background-size: 20px 20px;
    }
</style>
<body>
<script>
  var selectPosition=gBundle.manager
  var isPay=(gBundle.isPay==="1")
  var userData=gBundle
  lifeCycle.onCreate=function (){
      singlePermisson= (gBundle.singlePermisson==="0") ? 0:1
     $('#authSituation')[0].selectedIndex=(parseInt(gBundle.manager,10)+1)
      $('#memberSituation')[0].selectedIndex=(parseInt(gBundle.singlePermisson,10))
      $('#paySituation')[0].selectedIndex=(parseInt(gBundle.isPay,10))
      updatePay()
  }
  function updatePay(){
      $('#notPay').hide()
      $('#payMoney').hide()
      $('#notPayT').hide()
      $('#payMoneyT').hide()
      if($('#paySituation')[0].selectedIndex===0){
          $('#notPay').show()
          $('#notPayT').show()
      }else if($('#paySituation')[0].selectedIndex===1){
          $('#payMoney').show()
          $('#payMoneyT').show()
      }
  }
  lifeCycle.onCreateView=function (){
    return `
    <div class="topBar">
      <img src="../img/btn_back_normal.png" style="width: 40px;height: 40px;" onmousedown="glitter.goBack();">
    <h3 style="color: white;flex: auto;font-size: 16px;text-align: center;margin-right: 40px;">編輯人員權限</h3>
    </div>
    <h3 style="background-color:white;margin:0;font-size:16px;height: 50px;display: flex;align-items: center;justify-content: center;width: 100%;color: #1a4064;font-weight: 600;border-bottom: 1px solid whitesmoke;">
    ${gBundle.pick}
</h3>
<div style="height: calc(100% - 170px);overflow-y: scroll;width: 100%;" >
<div style="width: 100%;overflow-y: scroll;height: 100%;">
 <div class="content">
<img class="head" id="head" onclick="addImageView()" src="${userData.head}">
<h3 class="smallTitle">授權情況</h3>
<select id="authSituation" style="width: calc(100% - 20px);border: 1px solid lightgray;height: 40px;box-shadow: none;margin-top: 10px;font-size: 16px;">
  <option value="-1">未認證</option>
  <option value="0">已認證</option>
  <option value="1">管理員</option>
</select>
<h3 class="smallTitle" style="margin-top: 5px;">會員身份</h3>
      <select id="memberSituation" style="width: calc(100% - 20px);border: 1px solid lightgray;height: 40px;box-shadow: none;margin-top: 10px;font-size: 16px;">
  <option value="0">個人會員</option>
  <option value="1">終身會員</option>
  <option value="2">自然會員</option>
    <option value="3">團體會員</option>
     <option value="4">非會員</option>
</select>
         <h3 class="smallTitle" style="margin-top: 5px;">繳費狀況</h3>
<select id="paySituation"select style="width: calc(100% - 20px);border: 1px solid lightgray;height: 40px;box-shadow: none;margin-top: 10px;font-size: 16px;"
onchange="
  updatePay()
">
  <option value="0">未繳費</option>
  <option value="1">已繳費</option>
  <option value="2">無需繳費</option>
</select>
        <h3 class="smallTitle" id="notPayT">待繳金額</h3>
<input id="notPay" value="${userData.notPay}" type="number" onchange="if($(this).val()===''){
    $(this).val('0')
}
" placeholder="待繳金額">
   <h3 class="smallTitle" id="payMoneyT">已繳金額</h3>
<input id="payMoney" value="${userData.payMoney}" type="number" placeholder="已繳金額" onchange="if($(this).val()===''){
    $(this).val('0')
}
userData.payMoney= $(this).val()
">
<h3 class="smallTitle">電子信箱</h3>
<input id="email" value="${userData.email}" placeholder="請輸入你的信箱">

<h3 class="smallTitle">姓名</h3>
<input id="pick" value="${userData.pick}" placeholder="請輸入您的全名">
<h3 class="smallTitle">性別</h3>
<div class="flexSelect">
<div class="selectItem">
 <div id="male" class="checkBox ${(userData.gender=='0') ? 'check':''}" onclick="$('.checkBox').removeClass('check');$('#male').addClass('check');gender=0;"></div>
<span>男性</span>
</div>
<div class="selectItem">
 <div id="female" class="checkBox ${(userData.gender=='1') ? 'check':''}" onclick="$('.checkBox').removeClass('check');$('#female').addClass('check');gender=1;"></div>
<span>女性</span>
</div>
</div>

<h3 class="smallTitle">生日</h3>
<input id="birthday" style="background-color:white;width:calc(100% - 40px);min-height: 40px;"   data-date-format="yyyy-mm-dd" data-provide="datepicker" value="${userData.birthday.substring(0,10)}" contenteditable="false"
onclick="glitter.openDiaLog('publicResource/dialog/Dia_Date_Picker.html','Dia_Date_Picker',false,true,{
             callback:function (text){$('#birthday').val(text.substring(0,10).replace('/','-').replace('/','-'))},
             data:{ time: false, nowButton: false, clearButton: false, format: 'YYYY/MM/DD', lang: ('zh-cn')   }
         })" readonly>
<h3 class="smallTitle">畢業科系</h3>
<input id="gurade" value="${userData.gurade}" placeholder="請輸入您的畢業科系">
<h3 class="smallTitle">會員編號</h3>
<input id="userCode" value="${(userData.userCode===undefined) ? '':userData.userCode}" placeholder="請輸入您的會員編號">
<h3 class="smallTitle">電話</h3>
<input id="phone" value="${userData.phone}" type="number" placeholder="請輸入您的電話">
<h3 class="smallTitle">地址</h3>
<input id="address" value="${userData.address}" placeholder="請輸入您的地址">
<div style="flex: auto;">
</div>
</div>
</div>

</div>

<div class="sig" style="height: 50px;margin: 10px;display: flex;">
<div onclick="
glitter.openDiaLog('publicResource/dialog/Check_Yes_Not.html','Check_Yes_Not',false,false,{
    title:'是否確認刪除用戶!?',
    callback:function (result){
    if(result){
      glitter.share.dataLoading(true)
      glitter.publicBeans.publicLogic.deleteUser(gBundle.id,function (response){
        glitter.share.dataLoading(false)
        if(response.result){
          glitter.closeBottomSheet()
            glitter.goBack()
              glitter.share.hint('刪除成功!!')
        }else{
          glitter.share.hint('刪除失敗!!')
        }
      })
    }
    glitter.closeDiaLogWithTag('Check_Yes_Not')
  }
  },function (){})
" style="color: black;height: 50px;width: calc(50% - 10px);text-align: center;line-height: 50px;border-width: 1px;border-color:gray;border-style: solid;border-top-left-radius: 25px;border-bottom-left-radius: 25px;">
刪除用戶
</div>
<div style="margin-left:10px;color: white;height: 50px;flex:auto;text-align: center;line-height: 50px;border-width: 1px;border-color:white;border-style: solid;border-bottom-right-radius: 25px;border-top-right-radius: 25px;background-color :dodgerblue;" onclick="postInfo()">
確認修改
</div>
</div>
    `
  }
  var gender=userData.gender
  function postInfo() {
      var model = {}
      model.userID=userData.userID
      model.userCode=$('#userCode').val()
      model.account = userData.account
      model.password = userData.password
      model.notPay=$('#notPay').val()
      model.payMoney=$('#payMoney').val()
      model.singlePermisson=parseInt($('#memberSituation').val(),10)
      model.isPay=parseInt($('#paySituation').val(),10)
      model.head = $('#head').attr('src')
      model.pick = $('#pick').val()
      model.gurade=$('#gurade').val()
      if($('#birthday').val().indexOf("00:00:00")===-1){
          model.birthday=`${$('#birthday').val()} 00:00:00`
      }else{
          model.birthday=`${$('#birthday').val()}`
      }

      model.manager= parseInt($('#authSituation').val(),10)
      model.gender=gender
      model.socialId=userData.socialId
      model.email=$('#email').val()
      model.phone=$('#phone').val()
      model.address=$('#address').val()
      if ((model.pick === '')) {
          glitter.openDiaLog('dialog/Dia_Info.html', 'Dia_Info', false, true, "請輸入你的名稱", function () {
          })
          return
      }  else if (model.account === '') {
          glitter.openDiaLog('dialog/Dia_Info.html', 'Dia_Info', false, true, "帳號不得為空", function () {
          })
          return
      }else if($('#birthday').val() === ''){
          glitter.openDiaLog('dialog/Dia_Info.html', 'Dia_Info', false, true, "請輸入您的生日", function () {
          })
          return
      }else if($('#gender').val() === ''){
          glitter.openDiaLog('dialog/Dia_Info.html', 'Dia_Info', false, true, "請選擇您的性別", function () {
          })
          return
      }else if($('#phone').val() === ''){
          glitter.openDiaLog('dialog/Dia_Info.html', 'Dia_Info', false, true, "請輸入您的電話", function () {
          })
          return
      }else if($('#address').val() === ''){
          glitter.openDiaLog('dialog/Dia_Info.html', 'Dia_Info', false, true, "請輸入您的地址", function () {
          })
          return
      }else if(model.email === ''){
          glitter.openDiaLog('dialog/Dia_Info.html', 'Dia_Info', false, true, "請輸入您的信箱", function () {
          })
          return
      }
      glitter.share.dataLoading(true)
      glitter.publicBeans.publicLogic.changeInfo(model,function (response){
          glitter.share.dataLoading(false)
          if(response===undefined){
              glitter.share.internetError()
          }else{
              if(response.result){
                  if(glitter.publicBeans.publicLogic.customDefine.user_data.account===model.account){
                  glitter.copyObj(glitter.publicBeans.publicLogic.customDefine.user_data,model)
                  }
                  glitter.goBack()
                  glitter.share.hint("更改資料成功")
              }else{
                  glitter.share.hint("更改資料失敗")
              }
          }
      })
  }
</script>
</body>
</html>